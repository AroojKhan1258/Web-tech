<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout â€” Extreme Adventures</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.8/jquery.inputmask.min.js"></script>

<style>
body {
  font-family:"Poppins",sans-serif; 
  background:#000; 
  color:#fff; 
  margin:0;
}
h2, h5 { margin-bottom:20px; }
.card-bg { background:#111; border:none; border-radius:12px; padding:20px; margin-bottom:30px; box-shadow:0 0 15px rgba(255,77,77,0.2); }
.list-group-item { background:#222; border:none; display:flex; justify-content:space-between; padding:12px 15px; border-radius:8px; margin-bottom:10px; }
.btn { background:#ff4d4d; color:#fff; border-radius:8px; transition:0.3s; }
.btn:hover { background:#e63c3c; }
.step { font-size:14px; padding:6px 12px; border-radius:999px; border:1px solid rgba(255,255,255,0.2); margin-right:5px; cursor:pointer; }
.step.active { background:#ff4d4d; border-color:#ff4d4d; }
.checkout-step { display:none; }
.checkout-step.active { display:block; }
input, select, textarea { background:#222; color:#fff; border:1px solid #333; border-radius:8px; padding:10px; }
input::placeholder, textarea::placeholder { color:#bbb; }
.review-summary { background:#222; padding:15px; border-radius:8px; margin-top:15px; }
.review-summary div { display:flex; justify-content:space-between; margin-bottom:8px; }
.review-summary div.total { font-weight:bold; font-size:18px; border-top:1px solid #555; padding-top:8px; }
</style>
</head>

<body>

<%- include("partials/header") %>

<main class="container py-5">

  <h2>Checkout</h2>

  <!-- Steps Navigation -->
  <div class="mb-4 d-flex flex-wrap align-items-center gap-2">
    <span class="step active" data-step="cart">Cart</span>
    <span class="step" data-step="customer">Customer & Shipping</span>
    <span class="step" data-step="payment">Payment</span>
    <span class="step" data-step="review">Review</span>
  </div>

  <!-- Step 1: Cart -->
  <div id="cart" class="checkout-step active card card-bg p-4">
    <h5>Your Cart</h5>
    <ul id="cartItems" class="list-unstyled"></ul>
    <div class="d-flex justify-content-between"><span>Subtotal:</span><span id="subtotal">â‚¨ 0</span></div>
    <div class="d-flex justify-content-between"><span>Shipping:</span><span>â‚¨ 500</span></div>
    <div class="d-flex justify-content-between"><span>Tax:</span><span id="tax">â‚¨ 0</span></div>
    <div class="d-flex justify-content-between fw-bold"><span>Total:</span><span id="grandTotal">â‚¨ 0</span></div>
    <button class="btn mt-3 float-end" id="nextToCustomer">Next</button>
  </div>

  <!-- Step 2: Customer & Shipping -->
  <div id="customer" class="checkout-step card card-bg p-4">
    <h5>Customer & Shipping</h5>
    <form id="customerForm">
      <div class="mb-3">
        <input type="text" placeholder="Full Name" id="customerName" required class="form-control">
        <div class="invalid-feedback">Please enter your full name.</div>
      </div>
      <div class="mb-3">
        <input type="email" placeholder="Email" id="customerEmail" required class="form-control">
        <div class="invalid-feedback">Please enter a valid email.</div>
      </div>
      <div class="mb-3">
        <textarea placeholder="Shipping Address" id="customerAddress" required class="form-control"></textarea>
        <div class="invalid-feedback">Please enter your shipping address.</div>
      </div>
      <button class="btn" id="backToCart">Back</button>
      <button class="btn float-end" id="nextToPayment">Next</button>
    </form>
  </div>

  <!-- Step 3: Payment -->
  <div id="payment" class="checkout-step card card-bg p-4">
    <h5>Payment Details</h5>
    <form id="paymentForm">
      <div class="mb-3">
        <input type="text" placeholder="Card Number" id="cardNumber" required class="form-control">
      </div>
      <div class="mb-3">
        <input type="text" placeholder="Name on Card" id="cardName" required class="form-control">
      </div>
      <div class="row">
        <div class="col mb-3">
          <input type="text" placeholder="Expiry MM/YY" id="cardExpiry" required class="form-control">
        </div>
        <div class="col mb-3">
          <input type="text" placeholder="CVC" id="cardCVC" required class="form-control">
        </div>
      </div>
      <button class="btn mt-3" id="backToCustomer">Back</button>
      <button class="btn mt-3 float-end" id="nextToReview">Next</button>
    </form>
  </div>

  <!-- Step 4: Review -->
  <div id="review" class="checkout-step card card-bg p-4">
    <h5>Review Your Order</h5>
    <ul id="reviewItems" class="list-unstyled"></ul>
    <div class="review-summary">
      <div><span>Subtotal:</span><span id="reviewSubtotal">â‚¨ 0</span></div>
      <div><span>Shipping:</span><span>â‚¨ 500</span></div>
      <div><span>Tax:</span><span id="reviewTax">â‚¨ 0</span></div>
      <div class="total"><span>Total:</span><span id="reviewTotal">â‚¨ 0</span></div>
    </div>
    <button class="btn mt-3" id="backToPayment">Back</button>
    <button class="btn mt-3 float-end" id="placeOrder">Place Order</button>
  </div>

</main>

<%- include("partials/footer") %>

<script>
$(document).ready(function(){

  // Cart data
  let cart = [
    { id:1, name:"Skydiving Experience", price:12000, quantity:1 },
    { id:2, name:"Mountain Climb", price:12000, quantity:2 }
  ];
  const shippingCost = 500;
  const taxRate = 0.1;

  // Mask card inputs
  $("#cardNumber").inputmask("9999 9999 9999 9999");
  $("#cardExpiry").inputmask("99/99");
  $("#cardCVC").inputmask("999");

  function calculateTotals() {
    let subtotal = 0;
    cart.forEach(i => subtotal += i.price * i.quantity);
    let tax = Math.round(subtotal * taxRate);
    let total = subtotal + tax + shippingCost;
    return {subtotal, tax, total};
  }

  function renderCart() {
    $("#cartItems").empty();
    let totals = calculateTotals();
    cart.forEach(item=>{
      $("#cartItems").append(`<li class="list-group-item"><span>${item.name} (x${item.quantity})</span><span>â‚¨ ${item.price*item.quantity}</span></li>`);
    });
    $("#subtotal").text("â‚¨ " + totals.subtotal);
    $("#tax").text("â‚¨ " + totals.tax);
    $("#grandTotal").text("â‚¨ " + totals.total);
  }

  function renderReview() {
    $("#reviewItems").empty();
    let totals = calculateTotals();
    cart.forEach(item=>{
      $("#reviewItems").append(`<li class="list-group-item"><span>${item.name} (x${item.quantity})</span><span>â‚¨ ${item.price*item.quantity}</span></li>`);
    });
    $("#reviewSubtotal").text("â‚¨ " + totals.subtotal);
    $("#reviewTax").text("â‚¨ " + totals.tax);
    $("#reviewTotal").text("â‚¨ " + totals.total);
  }

  renderCart();

  // Step Navigation
  function showStep(stepId) {
    $(".checkout-step").removeClass("active");
    $("#" + stepId).addClass("active");
    $(".step").removeClass("active").filter(`[data-step="${stepId}"]`).addClass("active");
  }

  $("#nextToCustomer").click(()=> showStep("customer"));
  $("#backToCart").click(e=> { e.preventDefault(); showStep("cart"); });
  $("#nextToPayment").click(e=>{
    e.preventDefault();
    if(!$("#customerForm")[0].checkValidity()) {
      $("#customerForm")[0].reportValidity();
      return;
    }
    showStep("payment");
  });
  $("#backToCustomer").click(e=> { e.preventDefault(); showStep("customer"); });
  $("#nextToReview").click(e=>{
    e.preventDefault();
    if(!$("#paymentForm")[0].checkValidity()) {
      $("#paymentForm")[0].reportValidity();
      return;
    }
    renderReview();
    showStep("review");
  });
  $("#backToPayment").click(()=> showStep("payment"));

  $("#placeOrder").click(()=> {
    alert("ðŸŽ‰ Your order has been placed successfully!");
    location.reload();
  });

});
</script>

</body>
</html>
